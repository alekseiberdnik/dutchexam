<!DOCTYPE html>
<html lang="en">
<head>
 <link rel="stylesheet" href="assets/brand.css"/>
 <link rel="stylesheet" href="assets/tests.css"/>
 <link rel="stylesheet" href="assets/progress.css"/>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DutchExam.online — In-Depth Level Test (~12 min)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
 :root{
 --bg:#f8fafc; --paper:#ffffff; --text:#0f172a; --muted:#475569; --line:#e2e8f0;
 --blue:#2563eb; --blue-2:#3b82f6; --blue-50:#eff6ff;
 --yellow:#f59e0b; --yellow-2:#fde68a; --yellow-50:#fffbeb;
 --ok:#16a34a; --bad:#ef4444;
 --radius:18px; --shadow:0 16px 40px rgba(2,6,23,.08);
 }
 *{box-sizing:border-box}
 html,body{height:100%}
 body{
 margin:0; font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
 background:
 radial-gradient(1200px 700px at 8% -10%, #eef2ff 0%, transparent 60%),
 radial-gradient(1200px 700px at 92% 0%, #fff7cc 0%, transparent 60%),
 var(--bg);
 }
 .wrap{max-width:1200px; margin:0 auto; padding:22px 16px 80px}
 .grid{display:grid; grid-template-columns:300px 1fr; gap:18px}
 @media (max-width:980px){ .grid{grid-template-columns:1fr} }

 /* SIDEBAR */
 .side{
 position:sticky; top:16px;
 background:var(--paper); border:1px solid var(--line); border-radius:var(--radius);
 box-shadow:var(--shadow); padding:18px;
 }
 .side h3{margin:6px 0 8px; font-size:1.1rem}
 .pill{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:.9rem}
 .pill-blue{background:var(--blue-50); color:var(--blue); border:1px solid #bfdbfe}
 .pill-yellow{background:var(--yellow-50); color:#8d5c00; border:1px solid #fde68a}
 .kv{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; margin:8px 0}
 .val{font-weight:800}
 .barwrap{height:10px; background:#eef2f7; border-radius:999px; overflow:hidden; margin:10px 0}
 .bar{height:100%; width:0%; background:linear-gradient(90deg,#34d399,#22c55e); transition:width .25s ease}

 /* MAIN */
 .card{
 background:var(--paper); border:1px solid var(--line); border-radius:var(--radius);
 box-shadow:var(--shadow); padding:22px; margin-bottom:18px;
 }
 h1{font-size: clamp(1.8rem, 1.6rem + 1.8vw, 2.6rem); margin:4px 0 6px; letter-spacing:-.02em}
 p.lead{color:var(--muted); margin:0 0 10px}
 .progress{height:10px; background:#eef2f7; border-radius:999px; overflow:hidden; margin:10px 0 16px}
 .progress .pbar{height:100%; width:0%; background:linear-gradient(90deg, var(--blue-2), var(--blue)); transition:width .25s ease}

 .qtitle{font-weight:800; margin:2px 0 8px}
 .qmeta{color:var(--muted); font-size:.95rem; margin-bottom:6px}

 .input{
 display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:12px;
 background:#fff; border:1px solid var(--line);
 }
 .input input{flex:1; border:0; outline:0; background:transparent; font-size:1rem; color:var(--text)}

 textarea.textarea{
 width:100%; min-height:120px; padding:12px 14px; border-radius:12px; border:1px solid var(--line);
 font-family:inherit; font-size:1rem; resize:vertical; background:#fff;
 }
 .muted{color:var(--muted)}

 .opts{display:grid; gap:10px; margin-top:12px}
 .opt{
 border:1px solid var(--line); background:#fff; padding:12px 14px; border-radius:12px; cursor:pointer; text-align:left;
 transition: border-color .15s ease, background .15s ease, transform .08s ease, box-shadow .15s ease;
 }
 .opt:hover{transform:translateY(-1px); border-color:#bfdbfe; box-shadow:0 8px 18px rgba(2,6,23,.06)}
 .opt.correct{outline:2px solid var(--ok); background:#f0fdf4}
 .opt.wrong{outline:2px solid var(--bad); background:#fef2f2}

 .tokens, .slots{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
 .token, .slot{
 user-select:none;
 border:1px dashed #bfdcff; background:var(--blue-50); color:var(--blue);
 padding:8px 10px; border-radius:10px; cursor:pointer; min-width:44px; text-align:center; font-weight:700;
 }
 .slot{ background:#fff; border:1px dashed #94a3b8; color:#64748b }
 .slot.filled{border-style:solid}
 .token.dragging{opacity:.6}

 select.select{
 padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; font-weight:600
 }
 .textblock{background:#fff; border:1px solid var(--line); border-radius:12px; padding:12px}

 .btns{display:flex; gap:12px; flex-wrap:wrap; margin-top:14px}
 .btn{
 appearance:none; border:0; border-radius:12px; cursor:pointer; padding:12px 16px; font-weight:800;
 transition: transform .16s ease, box-shadow .2s ease, filter .2s ease;
 }
 .btn:hover{transform:translateY(-2px)}
 .primary{color:#fff; background:linear-gradient(180deg,var(--blue-2),var(--blue)); box-shadow:0 10px 24px rgba(37,99,235,.22)}
 .secondary{background:linear-gradient(180deg,var(--yellow-2),var(--yellow)); color:#0f172a; box-shadow:0 10px 24px rgba(245,158,11,.22)}
 .ghost{background:#fff; border:1px solid var(--line); color:#0f172a}
 .status{font-weight:700; margin-top:6px}
 .ok{color:var(--ok)} .bad{color:var(--bad)}

 .result{display:none}
 .center{text-align:center}

 .topnav{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px}
 .brand{font-weight:800}
 .topnav a{color:var(--blue); text-decoration:none; font-weight:700}
</style>
</head>
<body>
 <div class="wrap">
 <div class="topnav">
 <div class="brand">DutchExam.online</div>
 <div><a href="index.html">← Back</a> • <a href="tests.html">All tests</a></div>
 </div>

 <div class="grid">
 <!-- SIDEBAR -->
 <aside class="side" id="sidebar">
 <h3> </h3>
 <div id="levelBadge" class="pill pill-blue">—</div>

 <div class="kv">
 <div></div>
 <div class="val"><span id="accVal">—</span></div>
 </div>
 <div class="barwrap"><div id="accBar" class="bar" style="width:0%"></div></div>

 <div class="kv">
 <div></div>
 <div class="val"><span id="pointsVal">0</span></div>
 </div>

 <div class="kv">
 <div></div>
 <div class="val"><span id="qpos">1</span>/<span id="qtotal">18</span></div>
 </div>

 <div class="pill pill-yellow" style="margin-top:10px">In-Depth ~12 min</div>
 <p class="muted" style="margin-top:10px">Longer texts + two short writing tasks. Complete, choose, drag, select, or write.</p>
 </aside>

 <!-- MAIN -->
 <main>
 <section class="card">
 <h1>In-Depth Dutch level test</h1>
 <p class="lead">Tests longer texts and includes writing checks. We’ll estimate your level as you go.</p>
 <div class="progress"><div id="pbar" class="pbar"></div></div>
 <div class="qmeta" id="qmeta"></div>
 <div class="qtitle" id="qtitle"></div>

 <!-- dynamic question host -->
 <div id="qhost"></div>

 <div class="status" id="status"></div>

 <div class="btns">
 <button id="checkBtn" class="btn primary">Check</button>
 <button id="nextBtn" class="btn ghost" disabled>Next</button>
 <button id="skipBtn" class="btn ghost">Skip</button>
 <button id="restartBtn" class="btn secondary" style="margin-left:auto">Restart</button>
 </div>
 </section>

 <!-- RESULT -->
 <section class="card result" id="resultCard">
 <h2 class="center">Your in-depth test result</h2>
 <p class="center"><strong>Score:</strong> <span id="finalPoints">0</span> / <span id="finalTotal">0</span> •
 <strong>Accuracy:</strong> <span id="finalAcc">0%</span></p>
 <p class="center"><strong>Estimated level:</strong> <span id="finalLevel">—</span></p>
 <div class="center btns" style="justify-content:center">
 <a class="btn primary" href="tests.html">Choose another test</a>
 <button class="btn ghost" id="againBtn">Retake this test</button>
 </div>
 </section>
 </main>
 </div>
 </div>

<script>
/** ====== DATA ====== */
const QUESTIONS = [
 // 1 input
 { type:'input', prompt:'Vul in: Ik ___ in Rotterdam.', answer:['woon'], help:'“ik woon” (zonder -t).' },

 // 2 mc
 { type:'mc', prompt:'Kies het juiste woord: Wij ___ morgen met de trein.', options:['gaat','gaan','ging'], correctIndex:1, help:'“wij gaan”.' },

 // 3 select
 { type:'select', prompt:'Kies de juiste vorm: Hij ___ vandaag thuis.', options:['werk','werkt','werken'], correctIndex:1, help:'Hij werkt (3e persoon -t).' },

 // 4 dnd
 { type:'dnd', prompt:'Zet de woorden in de juiste volgorde:', words:['Ik','heb','een','afspraak','om','negen','uur.'] },

 // 5 reading (1)
 { type:'reading',
 text:'De huisartspraktijk is open van maandag tot en met vrijdag van 8:00 tot 17:00. U kunt bellen voor een afspraak tussen 8:00 en 12:00. Voor spoed belt u optie 1.',
 question:'Wanneer kunt u bellen voor een afspraak?',
 options:['8:00–12:00','12:00–17:00','Altijd'],
 correctIndex:0
 },

 // 6 reading (1) follow-up
 { type:'reading',
 text:'De huisartspraktijk is open van maandag tot en met vrijdag van 8:00 tot 17:00. U kunt bellen voor een afspraak tussen 8:00 en 12:00. Voor spoed belt u optie 1.',
 question:'Wat moet u kiezen bij spoed?',
 options:['Optie 1','Optie 2','Geen optie'],
 correctIndex:0
 },

 // 7 input
 { type:'input', prompt:'Vul in: Kunt u mij ___, alstublieft?', answer:['helpen'], help:'Infinitief na “kunt u mij”: helpen.' },

 // 8 mc polite
 { type:'mc', prompt:'Wat zegt u in de winkel?', options:['Geef tas.','Mag ik een tas, alstublieft?','Ik wil tas nu.'], correctIndex:1, help:'Beleefd: “Mag ik …, alstublieft?”' },

 // 9 dnd question
 { type:'dnd', prompt:'Maak de vraag:', words:['Waar','is','de','gemeente?'] },

 // 10 reading (2)
 { type:'reading',
 text:'De bibliotheek in uw stad organiseert elke woensdag een taalcafé van 18:30 tot 20:00. U kunt daar Nederlands oefenen met vrijwilligers. Deelname is gratis, maar aanmelden is verplicht via de website.',
 question:'Wat moet u doen om mee te doen?',
 options:['Langskomen zonder iets te doen','Aanmelden via de website','Een kaartje kopen'],
 correctIndex:1
 },

 // 11 reading (2) follow-up
 { type:'reading',
 text:'De bibliotheek in uw stad organiseert elke woensdag een taalcafé van 18:30 tot 20:00. U kunt daar Nederlands oefenen met vrijwilligers. Deelname is gratis, maar aanmelden is verplicht via de website.',
 question:'Wat kost deelname?',
 options:['€5 per keer','Gratis','Alleen de eerste keer gratis'],
 correctIndex:1
 },

 // 12 select time phrase
 { type:'select', prompt:'Kies: Ik kom ___ (’s ochtends / ’s avonds / vannacht).', options:['’s ochtends','’s avonds','vannacht'], correctIndex:1, help:'Contextafhankelijk; kies “’s avonds” als standaard voorbeeld.' },

 // 13 writing (short reschedule email)
 { type:'writing',
 prompt:'Schrijf een kort e-mailtje aan de gemeente om uw afspraak te verzetten. Noem dat u morgen niet kunt en vraag om een nieuwe datum (2–3 zinnen).',
 minWords: 12,
 keywords: ['afspraak','morgen','kan','niet','verzetten'], // any 2+ count
 requiredCount: 2,
 help:'Noem “afspraak”, dat u “morgen niet” kunt en dat u wilt “verzetten”.'
 },

 // 14 mc past
 { type:'mc', prompt:'Welke zin is in de verleden tijd correct?', options:['Gisteren ga ik naar de school.','Gisteren ging ik naar school.','Gisteren gaan ik naar school.'], correctIndex:1 },

 // 15 input separable
 { type:'input', prompt:'Vul in: Ik ___ de deur ___ (opendoen).', answer:['doe open','open doe'], help:'“Ik doe de deur open.”' },

 // 16 writing (complaint to neighbor)
 { type:'writing',
 prompt:'Schrijf een beleefd bericht aan de buur over harde muziek laat in de avond. Vraag of het rustiger kan. (min. 20 woorden).',
 minWords: 20,
 keywords: ['muziek','laat','avond','rustiger','alstublieft'],
 requiredCount: 2,
 help:'Gebruik woorden als “muziek”, “laat in de avond”, “rustiger”, “alstublieft”.'
 },

 // 17 mc modal verbs
 { type:'mc', prompt:'Kies de juiste zin:', options:['Ik moet bellen de gemeente.','Ik moet de gemeente bellen.','Ik bellen moet de gemeente.'], correctIndex:1, help:'Werkwoord aan het eind: “moet … bellen”.' },

 // 18 input polite request
 { type:'input', prompt:'Vul in: ___ ik binnenkomen? (polite)', answer:['Mag','mag'], help:'“Mag ik binnenkomen?”' }
];

const TOTAL = QUESTIONS.length;

/** ====== STATE ====== */
let idx = 0;
let correct = 0;
let attempted = 0;
let checked = false;
let dndState = null;

/** ====== DOM ====== */
const qmeta = document.getElementById('qmeta');
const qtitle = document.getElementById('qtitle');
const qhost = document.getElementById('qhost');
const statusEl = document.getElementById('status');
const checkBtn = document.getElementById('checkBtn');
const nextBtn = document.getElementById('nextBtn');
const skipBtn = document.getElementById('skipBtn');
const restartBtn = document.getElementById('restartBtn');
const resultCard = document.getElementById('resultCard');
const pbar = document.getElementById('pbar');

/** Sidebar */
const accVal = document.getElementById('accVal');
const accBar = document.getElementById('accBar');
const pointsVal = document.getElementById('pointsVal');
const qpos = document.getElementById('qpos');
const qtotal = document.getElementById('qtotal');
const levelBadge = document.getElementById('levelBadge');
qtotal.textContent = TOTAL;

/** Final */
const finalPoints = document.getElementById('finalPoints');
const finalTotal = document.getElementById('finalTotal');
const finalAcc = document.getElementById('finalAcc');
const finalLevel = document.getElementById('finalLevel');
const againBtn = document.getElementById('againBtn');

/** ====== RENDER ====== */
function render() {
 resultCard.style.display = 'none';
 qhost.innerHTML = '';
 statusEl.textContent = '';
 statusEl.className = 'status';
 checked = false;

 const q = QUESTIONS[idx];
 qmeta.textContent = `Question ${idx+1} of ${TOTAL}`;
 qtitle.innerHTML = q.prompt || '';

 // progress
 pbar.style.width = `${(idx)/TOTAL*100}%`;
 qpos.textContent = idx+1;

 if (q.type === 'input') {
 const box = document.createElement('div');
 box.className = 'input';
 box.innerHTML = `<input id="answerInput" type="text" placeholder="Type your answer…" autocomplete="off">`;
 qhost.appendChild(box);
 if (q.help) addHelp(q.help);
 }
 else if (q.type === 'mc') {
 const opts = document.createElement('div');
 opts.className = 'opts';
 q.options.forEach((optText, i) => {
 const b = document.createElement('button');
 b.type = 'button';
 b.className = 'opt';
 b.textContent = optText;
 b.addEventListener('click', () => {
 if (checked) return;
 document.querySelectorAll('.opt').forEach(o => o.dataset.sel = '0');
 b.dataset.sel = '1';
 document.querySelectorAll('.opt').forEach(o => o.style.outline = '');
 b.style.outline = '2px solid #bfdbfe';
 });
 opts.appendChild(b);
 });
 qhost.appendChild(opts);
 if (q.help) addHelp(q.help);
 }
 else if (q.type === 'dnd') {
 dndState = { slots: [], pool: null };
 const instr = document.createElement('div');
 instr.className = 'muted';
 instr.textContent = 'Drag or click words into the blanks in correct order.';
 qhost.appendChild(instr);

 const slots = document.createElement('div');
 slots.className = 'slots';
 q.words.forEach(() => {
 const s = document.createElement('button');
 s.type = 'button';
 s.className = 'slot';
 s.addEventListener('click', () => {
 if (s.textContent.trim() !== '') {
 const token = createToken(s.textContent);
 pool.appendChild(token);
 s.textContent = '';
 s.classList.remove('filled');
 }
 });
 slots.appendChild(s);
 dndState.slots.push(s);
 });
 qhost.appendChild(slots);

 const pool = document.createElement('div');
 pool.className = 'tokens';
 const shuffled = [...q.words].sort(() => Math.random()-0.5);
 shuffled.forEach(w => pool.appendChild(createToken(w)));
 qhost.appendChild(pool);
 dndState.pool = pool;

 dndState.slots.forEach(s => {
 s.addEventListener('dragover', (e) => e.preventDefault());
 s.addEventListener('drop', (e) => {
 e.preventDefault();
 const drag = document.querySelector('.token.dragging');
 if (!drag) return;
 if (s.textContent.trim() === ''){
 s.textContent = drag.textContent;
 s.classList.add('filled');
 drag.remove();
 }
 });
 });

 function createToken(text){
 const t = document.createElement('button');
 t.type = 'button';
 t.className = 'token';
 t.textContent = text;
 t.addEventListener('click', () => {
 const slot = dndState.slots.find(s => s.textContent.trim() === '');
 if (slot){
 slot.textContent = text;
 slot.classList.add('filled');
 t.remove();
 }
 });
 t.draggable = true;
 t.addEventListener('dragstart', () => t.classList.add('dragging'));
 t.addEventListener('dragend', () => t.classList.remove('dragging'));
 return t;
 }
 }
 else if (q.type === 'select') {
 const sel = document.createElement('select');
 sel.className = 'select';
 sel.id = 'answerSelect';
 sel.innerHTML = `<option value="">— choose —</option>` + q.options.map((o,i)=>`<option value="${i}">${o}</option>`).join('');
 qhost.appendChild(sel);
 if (q.help) addHelp(q.help);
 }
 else if (q.type === 'reading') {
 const tb = document.createElement('div');
 tb.className = 'textblock';
 tb.textContent = q.text;
 qhost.appendChild(tb);

 const qh = document.createElement('div');
 qh.className = 'qtitle';
 qh.style.marginTop = '10px';
 qh.textContent = q.question;
 qhost.appendChild(qh);

 const opts = document.createElement('div');
 opts.className = 'opts';
 q.options.forEach((optText, i) => {
 const b = document.createElement('button');
 b.type = 'button';
 b.className = 'opt';
 b.textContent = optText;
 b.addEventListener('click', () => {
 if (checked) return;
 document.querySelectorAll('.opt').forEach(o => o.dataset.sel = '0');
 b.dataset.sel = '1';
 document.querySelectorAll('.opt').forEach(o => o.style.outline = '');
 b.style.outline = '2px solid #bfdbfe';
 });
 opts.appendChild(b);
 });
 qhost.appendChild(opts);
 }
 else if (q.type === 'writing') {
 const ta = document.createElement('textarea');
 ta.id = 'answerText';
 ta.className = 'textarea';
 ta.placeholder = 'Write your short message in Dutch here…';
 qhost.appendChild(ta);

 const hint = document.createElement('div');
 hint.className = 'muted';
 hint.style.marginTop = '8px';
 const kwords = (q.keywords || []).join(', ');
 hint.innerHTML = `Tip: ${q.help || ''} • <strong>Min. ${q.minWords} woorden</strong>${kwords ? ' • Probeer deze woorden te gebruiken: ' + kwords : ''}.`;
 qhost.appendChild(hint);
 }

 nextBtn.disabled = true;

 function addHelp(text){
 const help = document.createElement('div');
 help.className = 'muted';
 help.style.marginTop = '8px';
 help.textContent = 'Tip: ' + text;
 qhost.appendChild(help);
 }
}

/** ====== CHECK / SCORE ====== */
function normalize(s){ return s.trim().toLowerCase().replace(/\s+/g,' '); }

function wordCount(s){ return (s.trim().match(/\b[\p{L}\p{N}’'-]+\b/gu) || []).length; }

function countKeywords(s, keywords){
 const low = s.toLowerCase();
 let c = 0;
 for (const k of keywords || []) {
 if (low.includes(k.toLowerCase())) c++;
 }
 return c;
}

function checkCurrent() {
 if (checked) return;
 const q = QUESTIONS[idx];
 let isCorrect = false;

 if (q.type === 'input') {
 const el = document.getElementById('answerInput');
 const v = (el && el.value) ? el.value : '';
 if (!v.trim()){ return showStatus('Type your answer first.'); }
 isCorrect = q.answer.map(a => normalize(a)).includes(normalize(v));
 }
 else if (q.type === 'mc' || q.type === 'reading') {
 const opts = Array.from(document.querySelectorAll('.opt'));
 const selIndex = opts.findIndex(o => o.dataset.sel === '1');
 if (selIndex === -1){ return showStatus('Choose an option first.'); }
 isCorrect = (selIndex === q.correctIndex);
 opts.forEach((o,i) => {
 if (i === q.correctIndex) o.classList.add('correct');
 if (i === selIndex && !isCorrect) o.classList.add('wrong');
 o.disabled = true;
 });
 }
 else if (q.type === 'dnd') {
 const filled = dndState.slots.every(s => s.textContent.trim() !== '');
 if (!filled){ return showStatus('Fill all blanks first.'); }
 const current = dndState.slots.map(s => s.textContent);
 isCorrect = current.join(' ') === QUESTIONS[idx].words.join(' ');
 dndState.slots.forEach((s,i) => {
 const ok = s.textContent === QUESTIONS[idx].words[i];
 s.style.outline = ok ? '2px solid #16a34a' : '2px solid #ef4444';
 });
 }
 else if (q.type === 'select') {
 const sel = document.getElementById('answerSelect');
 if (!sel || sel.value === ''){ return showStatus('Choose an option first.'); }
 isCorrect = Number(sel.value) === q.correctIndex;
 if (!isCorrect) sel.style.borderColor = '#ef4444'; else sel.style.borderColor = '#16a34a';
 }
 else if (q.type === 'writing') {
 const ta = document.getElementById('answerText');
 const text = (ta && ta.value) ? ta.value.trim() : '';
 if (!text){ return showStatus('Write your short message first.'); }
 const wc = wordCount(text);
 const kw = countKeywords(text, q.keywords || []);
 // Simple heuristic: meet min words AND at least N keywords → correct
 isCorrect = wc >= (q.minWords || 10) && kw >= (q.requiredCount || 2);
 // Visual cue
 ta.style.borderColor = isCorrect ? '#16a34a' : '#ef4444';
 const more = ` (${wc} words, ${kw} keyword${kw===1?'':'s'})`;
 if (!isCorrect){
 statusEl.textContent = 'Not quite. Make it a bit longer or include the key words.' + more;
 statusEl.className = 'status bad';
 }
 }

 attempted++;
 if (isCorrect) {
 correct++;
 if (q.type !== 'writing') {
 statusEl.textContent = 'Correct!';
 statusEl.className = 'status ok';
 } else if (!statusEl.textContent) {
 statusEl.textContent = 'Looks good — meets the writing criteria.';
 statusEl.className = 'status ok';
 }
 } else if (!statusEl.textContent) {
 statusEl.textContent = 'Not quite.' + (q.help ? ' ' + q.help : '');
 statusEl.className = 'status bad';
 }

 checked = true;
 nextBtn.disabled = false;
 updateMeters();
}

function showStatus(msg){ statusEl.textContent = msg; statusEl.className = 'status'; }

/** ====== METERS & LEVEL ====== */
function updateMeters(){
 const acc = attempted ? Math.round((correct/attempted)*100) : 0;
 document.getElementById('accVal').textContent = attempted ? acc + '%' : '—';
 document.getElementById('accBar').style.width = attempted ? acc + '%' : '0%';
 document.getElementById('pointsVal').textContent = String(correct);

 const lvl = estimateLevel(acc, attempted);
 const badge = document.getElementById('levelBadge');
 badge.textContent = lvl;
 badge.className = 'pill ' + (lvl.startsWith('A') ? 'pill-blue' : 'pill-yellow');
}

function estimateLevel(acc, attempts){
 if (attempts < 5) return '—';
 if (acc < 35) return 'A1 Beginner';
 if (acc < 65) return 'A2 Pre-Intermediate';
 if (acc < 85) return 'B1 Intermediate';
 return 'B2 Upper-Intermediate';
}

/** ====== NAV ====== */
function nextQuestion(){
 if (!checked) return;
 if (idx < TOTAL - 1){
 idx++; render();
 } else {
 finish();
 }
}
function skipQuestion(){
 if (!checked) { attempted++; }
 checked = true; nextQuestion();
}
function restart(){
 idx = 0; correct = 0; attempted = 0; checked = false;
 document.getElementById('resultCard').style.display = 'none';
 updateMeters(); render();
}
function finish(){
 document.getElementById('pbar').style.width = '100%';
 document.getElementById('finalPoints').textContent = correct;
 document.getElementById('finalTotal').textContent = TOTAL;
 const acc = attempted ? Math.round((correct/attempted)*100) : 0;
 document.getElementById('finalAcc').textContent = acc + '%';
 document.getElementById('finalLevel').textContent = estimateLevel(acc, attempted);
 document.getElementById('resultCard').style.display = 'block';
 document.getElementById('resultCard').scrollIntoView({behavior:'smooth', block:'center'});
}

/** ====== WIRE ====== */
document.getElementById('checkBtn').addEventListener('click', checkCurrent);
document.getElementById('nextBtn').addEventListener('click', nextQuestion);
document.getElementById('skipBtn').addEventListener('click', skipQuestion);
document.getElementById('restartBtn').addEventListener('click', restart);
document.getElementById('againBtn').addEventListener('click', restart);

/** init */
updateMeters();
render();
</script>


<section class="section test-shell" id="demo-in-depth">
 <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
 <h2>Free level test — In‑Depth</h2>
 <div style="display:flex;gap:8px;align-items:center">
 <div class="eyebrow">Q <span id="in-depth-xy">0</span></div>
 <div class="eyebrow">Time left: <span id="in-depth-clock">12:00</span></div>
 </div>
 </div>
 <div class="card" style="margin:10px 0">
 <div id="in-depth-progress" class="muted">Answered 0 / 0 • Remaining 0</div>
 <div id="in-depth-bar" class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
 <span id="in-depth-fill" class="progress-fill"></span>
 </div>
 </div>
 <p class="muted">Mixed sections: <strong>Lezen</strong>, <strong>Luisteren</strong> (with audio), <strong>Spreken</strong>, <strong>Schrijven</strong>, <strong>KNM</strong>. The timer starts on your first click and pauses while you interact with audio.</p>
 <details open class="card"><summary style="cursor:pointer;font-weight:800">Open/close test</summary>
 <div class="card question"><strong>Q1.</strong> &quot;Verboden te parkeren.&quot;
<label class="answers"><input type="radio" name="in-depth-q1" value="0"> Parking allowed</label>
<label class="answers"><input type="radio" name="in-depth-q1" value="1"> No parking</label>
<label class="answers"><input type="radio" name="in-depth-q1" value="2"> Residents only</label>
<input type="hidden" id="in-depth-a1" value="1">
</div><div class="card question"><strong>Q2.</strong> &quot;Appartement te huur, €950 p/m, 2 kamers.&quot;
<label class="answers"><input type="radio" name="in-depth-q2" value="0"> House for sale</label>
<label class="answers"><input type="radio" name="in-depth-q2" value="1"> Apartment for rent</label>
<label class="answers"><input type="radio" name="in-depth-q2" value="2"> Room wanted</label>
<input type="hidden" id="in-depth-a2" value="1">
</div><div class="card question"><strong>Q3.</strong> &quot;Geboortedatum&quot;
<label class="answers"><input type="radio" name="in-depth-q3" value="0"> Birthplace</label>
<label class="answers"><input type="radio" name="in-depth-q3" value="1"> Birth date</label>
<label class="answers"><input type="radio" name="in-depth-q3" value="2"> Nationality</label>
<input type="hidden" id="in-depth-a3" value="1">
</div><div class="card question"><strong>Q4.</strong> &quot;Uitgang Noord&quot;
<label class="answers"><input type="radio" name="in-depth-q4" value="0"> North exit</label>
<label class="answers"><input type="radio" name="in-depth-q4" value="1"> Entrance North</label>
<label class="answers"><input type="radio" name="in-depth-q4" value="2"> Exit closed</label>
<input type="hidden" id="in-depth-a4" value="0">
</div><div class="card question"><strong>Q5.</strong> <audio controls preload="auto" src="assets/audio/luisteren-1.wav" style="width:100%;margin:6px 0"></audio>
<label class="answers"><input type="radio" name="in-depth-q5" value="0"> Train departs 10:12 from platform 5</label>
<label class="answers"><input type="radio" name="in-depth-q5" value="1"> Train arrives 10:12</label>
<label class="answers"><input type="radio" name="in-depth-q5" value="2"> Bus leaves platform 5</label>
<input type="hidden" id="in-depth-a5" value="0">
</div><div class="card question"><strong>Q6.</strong> <audio controls preload="auto" src="assets/audio/luisteren-2.wav" style="width:100%;margin:6px 0"></audio>
<label class="answers"><input type="radio" name="in-depth-q6" value="0"> Train departs 10:12 from platform 5</label>
<label class="answers"><input type="radio" name="in-depth-q6" value="1"> Train arrives 10:12</label>
<label class="answers"><input type="radio" name="in-depth-q6" value="2"> Bus leaves platform 5</label>
<input type="hidden" id="in-depth-a6" value="0">
</div><div class="card question"><strong>Q7.</strong> <audio controls preload="auto" src="assets/audio/luisteren-3.wav" style="width:100%;margin:6px 0"></audio>
<label class="answers"><input type="radio" name="in-depth-q7" value="0"> Train departs 10:12 from platform 5</label>
<label class="answers"><input type="radio" name="in-depth-q7" value="1"> Train arrives 10:12</label>
<label class="answers"><input type="radio" name="in-depth-q7" value="2"> Bus leaves platform 5</label>
<input type="hidden" id="in-depth-a7" value="0">
</div><div class="card question"><strong>Q8.</strong> Best response to “Hoe gaat het?”
<label class="answers"><input type="radio" name="in-depth-q8" value="0"> Ik heet Anna.</label>
<label class="answers"><input type="radio" name="in-depth-q8" value="1"> Goed, dank je! En met jou?</label>
<label class="answers"><input type="radio" name="in-depth-q8" value="2"> Ik ga naar school.</label>
<input type="hidden" id="in-depth-a8" value="1">
</div><div class="card question"><strong>Q9.</strong> Polite request
<label class="answers"><input type="radio" name="in-depth-q9" value="0"> Doe de deur dicht.</label>
<label class="answers"><input type="radio" name="in-depth-q9" value="1"> Deur dicht.</label>
<label class="answers"><input type="radio" name="in-depth-q9" value="2"> Kunt u de deur dichtdoen?</label>
<input type="hidden" id="in-depth-a9" value="2">
</div><div class="card question"><strong>Q10.</strong> Ask for help
<label class="answers"><input type="radio" name="in-depth-q10" value="0"> Help mij nu.</label>
<label class="answers"><input type="radio" name="in-depth-q10" value="1"> Kunt u mij helpen?</label>
<label class="answers"><input type="radio" name="in-depth-q10" value="2"> Ik helpen.</label>
<input type="hidden" id="in-depth-a10" value="1">
</div><div class="card question"><strong>Q11.</strong> Formal opening to teacher
<label class="answers"><input type="radio" name="in-depth-q11" value="0"> Hoi vriend!</label>
<label class="answers"><input type="radio" name="in-depth-q11" value="1"> Geachte mevrouw Jansen,</label>
<label class="answers"><input type="radio" name="in-depth-q11" value="2"> Yo!</label>
<input type="hidden" id="in-depth-a11" value="1">
</div><div class="card question"><strong>Q12.</strong> Correct sentence
<label class="answers"><input type="radio" name="in-depth-q12" value="0"> Ik heb morgen geen tijd.</label>
<label class="answers"><input type="radio" name="in-depth-q12" value="1"> Morgen heb ik geen tijd.</label>
<label class="answers"><input type="radio" name="in-depth-q12" value="2"> Ik geen tijd morgen heb.</label>
<input type="hidden" id="in-depth-a12" value="1">
</div><div class="card question"><strong>Q13.</strong> Closing
<label class="answers"><input type="radio" name="in-depth-q13" value="0"> Groeten,</label>
<label class="answers"><input type="radio" name="in-depth-q13" value="1"> Met vriendelijke groet,</label>
<label class="answers"><input type="radio" name="in-depth-q13" value="2"> Doei!</label>
<input type="hidden" id="in-depth-a13" value="1">
</div><div class="card question"><strong>Q14.</strong> Emergency number in NL
<label class="answers"><input type="radio" name="in-depth-q14" value="0"> 112</label>
<label class="answers"><input type="radio" name="in-depth-q14" value="1"> 0900-8844</label>
<label class="answers"><input type="radio" name="in-depth-q14" value="2"> 911</label>
<input type="hidden" id="in-depth-a14" value="0">
</div><div class="card question"><strong>Q15.</strong> BSN is…
<label class="answers"><input type="radio" name="in-depth-q15" value="0"> Citizen service number</label>
<label class="answers"><input type="radio" name="in-depth-q15" value="1"> Bank account</label>
<label class="answers"><input type="radio" name="in-depth-q15" value="2"> Travel card</label>
<input type="hidden" id="in-depth-a15" value="0">
</div>
 <div class="card" style="margin:10px 0">
 <div class="muted">Time progress</div>
 <div id="in-depth-timebar" class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
 <span id="in-depth-timefill" class="progress-fill"></span>
 </div>
 </div>
 <div class="cta" style="margin-top:12px">
 <button class="btn primary" id="in-depth-submit">Check answers</button>
 <button class="btn ghost" id="in-depth-next" type="button">Next →</button>
 </div>
 <div id="in-depth-result" class="card" style="margin-top:12px;display:none"></div>
 </details>
</section>
<script>(function(){
 var TOTAL=15, BASE_MIN=12;
 var startedAt=null, finishedAt=null, timerId=null, remaining=BASE_MIN*60, begun=false;
 var answered=0;
 function fmt(t){ var m=Math.floor(t/60), s=t%60; return m+":"+(s<10?"0"+s:s); }
 function tick(){ remaining--; updateClock(); updateTimeBar(); if(remaining<=0){ clearInterval(timerId); submit(true); } }
 function updateClock(){ var el=document.getElementById("in-depth-clock"); if(el) el.textContent=fmt(remaining); }
 function updateProgress(){
 answered=0;
 for (var i=1;i<=TOTAL;i++) if (document.querySelector('input[name="in-depth-q'+i+'"]:checked')) answered++;
 var pct=Math.round(100*answered/TOTAL);
 var bar=document.getElementById("in-depth-bar"); var txt=document.getElementById("in-depth-progress");
 try{ document.getElementById('in-depth-xy').textContent = answered+' / '+TOTAL; }catch(e){}
 if (txt) txt.textContent = "Answered "+answered+" / "+TOTAL+" • Remaining "+(TOTAL-answered);
 if (bar) bar.setAttribute('aria-valuenow', String(pct));
 }
 function updateTimeBar(){
 var el=document.getElementById("in-depth-timebar"); var fill=document.getElementById("in-depth-timefill"); 
 if(el&&fill){ var totalSec = BASE_MIN*60; var pct = Math.max(0, Math.min(100, Math.round(100*(totalSec-remaining)/totalSec))); fill.style.width = pct + '%'; el.setAttribute('aria-valuenow', String(pct)); }
 }
 function ensureStart(){ if (begun) return; begun=true; startedAt=Date.now(); timerId=setInterval(tick,1000); updateClock(); updateTimeBar(); }
 function score(){ var s=0; for (var i=1;i<=TOTAL;i++){ var g=document.querySelector('input[name="in-depth-q'+i+'"]:checked'); var c=document.getElementById('in-depth-a'+i).value; if(g && String(g.value)===String(c)) s++; } return { s:s, acc: Math.round(100*s/TOTAL) }; }
 function render(s,acc,timeout){ var box=document.getElementById("in-depth-result"); box.style.display="block"; box.innerHTML='<h3>Result</h3><p>Score: <strong>'+s+' / '+TOTAL+'</strong> • Accuracy: <strong>'+acc+'%</strong>'+ (timeout?' • (time up)':'') +'</p><div class="cta" style="margin-top:8px"><a class="btn ghost" href="tests.html">Back to all tests</a></div>'; }
 function submit(timeout){ if(!finishedAt) finishedAt=Date.now(); clearInterval(timerId); var r=score(); render(r.s,r.acc,timeout); }
 document.addEventListener('click', function(e){ if(e.target.matches('input,button,a,select,textarea')) ensureStart(); if(e.target.matches('input[type=radio][name^="in-depth-q"]')){ var name=e.target.name; var idx=parseInt(name.split('-q')[1]||'0',10); var next=document.querySelector('#demo-in-depth .question:nth-of-type('+(idx+1)+')'); if(next) next.scrollIntoView({behavior:'smooth', block:'center'}); } updateProgress(); }, true);
 document.getElementById("in-depth-submit").addEventListener("click", function(){ if(!begun) ensureStart(); submit(false); });
 document.getElementById("in-depth-next").addEventListener("click", function(){ for (var i=1;i<=TOTAL;i++){ var has=document.querySelector('input[name="in-depth-q'+i+'"]:checked'); if(!has){ var q=document.querySelector('#demo-in-depth .question:nth-of-type('+i+')'); if(q) q.scrollIntoView({behavior:'smooth',block:'center'}); break; } } });
 // Pause timer when tab hidden; resume on visible
 document.addEventListener('visibilitychange', function(){ if(!startedAt || (!timerId && remaining<=0)) return; if(document.hidden){ if(timerId){clearInterval(timerId); timerId=null;} } else { if(!timerId && remaining>0) timerId=setInterval(tick,1000); } });
 // Pause timer when interacting with audio (hover or play)
 document.querySelectorAll('#demo-in-depth audio').forEach(function(a){ 
 a.addEventListener('mouseenter', function(){ if(timerId){clearInterval(timerId); timerId=null;} });
 a.addEventListener('mouseleave', function(){ if(!timerId && remaining>0) timerId=setInterval(tick,1000); });
 a.addEventListener('play', function(){ if(timerId){clearInterval(timerId); timerId=null;} });
 a.addEventListener('pause', function(){ if(!timerId && remaining>0) timerId=setInterval(tick,1000); });
 });
 // Init
 document.getElementById('in-depth-progress').textContent = "Answered 0 / "+TOTAL+" • Remaining "+TOTAL;
 updateClock(); updateTimeBar();
})();</script>

</div><!--wrap-end-->
</body>
</html>
